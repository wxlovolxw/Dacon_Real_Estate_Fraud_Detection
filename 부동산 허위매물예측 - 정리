--------------------------------------------------------------------

결측치 처리

결측치가 존재하는 여섯 피처 - '전용면적','해당층','총층','방수','욕실수','총주차대수'

'총층','방수','욕실수'피터는 결측치의 수가 매우 낮았으며, 결측이 동일한 행에서 발생하는 경향이 관찰되었다. 결측이 발생하는 조건을 명확하게 규명하지는 못했지만, 데이터 손실의 최소화하기 위해 최빈값으로 대체하였다.

나머지 세 피처는 결측치를 보간하기 전 결측여부와 다른 피처간의 관계를 탐색. 다른 피처들과 독립적이지 않은 관계를 확인했기 때문에 단순 무작위 발생이 아닌 조건부 결측으로 발생했을 가능성이 높다고 판단.

'해당층'의 경우 전체 데이터에 대해서 9.34퍼센트의 결측치가 존재. 범주형 변수 뿐만 아니라 연속형 변수들과도 독립적이지 않은 관계를 갖기 때문에 단순보간이 아닌 랜덤 포레스트를 통해서 보간. 해당 보간은 전처리 단계에서 수행한 것이기 때문에 과적합 방지를 위하여 별도의 파라미터 튜닝을 진행하지 않고 디폴트 값을 사용.

'총주차대수'의 경우 전제에 대해서 28.38퍼센트의 결측치가 존재. '해당층' 피처와 마찬가지로 연속형 변수들과도 관계가 많기 때문에 랜덤포레스트를 통해서 보간. 하지만 보간 전 후의 분포가 유의미하게 다르기 때문에 보간 전 후의 피처를 모두 유지. 보간 전후의 분포를 정성적으로 비교하기 위해 박스 플랏과 바이올린 플랏을 통해 시각화하였으며, Mann-Whitney U test를 통해 정량적으로 유의미한 차이를 확인. 해당 피처들이 정규성을 만족하지 않기 때문에 비모수 검정 방식을 적용하는 것이 적절하다고 판단.

-> 결측치의 처리도 가능하며 공선성의 영향을 덜 받는 모델을 사용해야함.

'전용면적' 피처의 경우 연속형 변수들과는 독립적이며 주로 범주형 변수들과 유의미한 관계를 갖기 때문에 그룹화를 통한 중앙값으로 보간. 오히려 랜덤포레스트가 왜곡을 유발할 가능성 있음.

'전용면적', '해당층', '총주차대수'는 결측 비율이 상대적으로 높고, 단순 누락이라기보다는 특정 조건에서 발생하는 결측일 가능성이 있다고 판단.
특히 이 세 피처의 결측 여부가 타겟 변수인 ‘허위매물여부’와도 일정한 연관성을 보였기 때문에, 결측을 단순히 보간하는 데 그치지 않고 결측여부 자체를 파생 피처로 생성.
반면, '총층', '방수', '욕실수'는 결측 비율이 극도로 낮고 타겟과의 관련성도 뚜렷하지 않아 별도의 결측여부 파생 피처는 생성하지 않음.


--------------------------------------------------------------------

이상치 처리 + 변환

연속형 변수들의 분포를 확인하기 이전에 군집의 형태를 산점도와 PCA(주성분분석), KMeans 클러스터, 실루엣 계수등을 통해 확인해본 결과, 플랏상에서도 군집의 형태를 확인하기 어려웠으며 KMeans 클러스터상에서 엘보우의 위치가 명확하지 않음. 또한 실루엣 계수 점수가 0.2로 군집의 형태가 명확하지 않은 것을 확인.

이에 따라 분포 기반의 이상치 탐지 방법이 더 적절하다고 판단하였으며, 특히 정규성 가정을 만족하지 않는 변수들이 다수 존재하여 비모수적이고 직관적인 기준을 제공하는 IQR 방식을 사용하여 이상치를 제거.

IQR을 통한 이상치의 제거후, 왜도를 계산하여 왜도를 최소화 하는 방향으로 변환을 적용.
'관리비','보증금' 피처에는 로그변환을 적용하였으며, '총층','해당층','총주차대수' 피처는 Box-cox 변환을 적용하였다.

변환 전후의 왜도를 비교한 결과 대부분의 피처에서 왜도가 유의미하게 감소하였으며, 분포가 정규성에 가까워지는 경향을 보임.
비록 변환 이후 정규성 검정(예: Shapiro-Wilk)을 다시 수행하지는 않았지만, KDE 플랏을 통해 시각적으로 확인한 결과, 대부분의 분포가 어느 정도 정규성을 따르는 형태로 개선된 것을 확인.

--------------------------------------------------------------------

재범주화 및 특성공학 적용

'게재일' 피처는 시계열적 특성과 정책적 외부요인의 영향을 모두 고려하여 다양한 방식으로 파생 피처를 생성.
먼저, 날짜 정보를 구성 요소별로 나눈 'year', 'month', 'day'와 '년월' 파생 피처를 생성하였고, 정책 변화 시점에 따라 구간을 나눈 '게재일_정책구간', 그리고 타겟값(허위매물여부) 분포 기반의 '게재일_구간' 파생 피처도 추가로 생성.
다만 '게재일_구간'은 타겟값을 기준으로 생성된 피처로, 학습 데이터에 대한 과적합 우려가 있어 최종 모델에서는 제외하였다. 대신, 정책 변경과 같이 외생적 요인을 반영할 수 있는 '게재일_정책구간'과, 정보 손실이 적으면서도 SHAP 기준 기여도가 안정적인 '년월' 피처를 최종적으로 선택.

'중개사무소'피처의 경우 범주의 수가 너무 많기 때문에 빈도수가 가장높은 5개를 유지한 채 나머지는 기타로 변경하는 '중개사무소_top5'와 빈도를 기반으로 재범주화한 '중개사무소_빈도기반'피처가 선택되었다.
또한 '방향' 피처의 경우 사인코사인 변환을 통해서 '방향_sin','방향_cos'을 추가적으로 파생피처로 생성하였다.

그 외에 타겟인 허위매물여부와 관련성이 낮고 통계적으로 독립적인 '매물확인방식','방수','욕실수','제공플랫폼' 피처를 제외 처리.

조합 탐색

'게재일'관련 피처와 '중개사무소'관련피처, '방향'관련 피처들의 모든 조합들을 LightGBH을 통해 모델링 한 후, F1 스코어와 정밀도, 재현율을 확인한 결과 '방향' 피처는 원본일때, '중개사무소'는 빈도기반일때, '게재일'은 년월로 카테고리화 되었을때의 성능이 가장 뛰어났기에 해당 피처들을 최종적으로 선택.

--------------------------------------------------------------------

데이터 불균형 처리

타겟인 '허위매물여부'피처는 다수의 정상매물과 소수의 허위매물이 존재하므로 데이터 불균형의 처리가 필수적. 소수의 클래스를 보완하는 오버샘플링 기법중 BorderlineSMOTE와 오버샘플링과 언더샘플링을 혼합한 SMOTETomek, 마지막으로 이상탐지 모델인 Isolation Forest을 비교.

각 방식에 대해 LightGBM 모델로 학습 후 F1 점수와 정밀도, 재현율을 기준으로 성능을 비교하였고,
Borderline-SMOTE를 적용했을 때 가장 균형 잡힌 성능을 보여 최종적으로 선택하였다.

--------------------------------------------------------------------

모델링

전체 데이터에는 다수의 상관된 피처가 존재하고, 일부 피처에 결측치가 남아 있기 때문에, 선형 모델보다는 공선성에 강하고 결측 처리가 내장된 트리 기반 모델이 적합하다고 판단.

주요 비교 대상 모델로는 LightGBM, XGBoost, CatBoost, Random Forest, Logistic Regression을 선정하여 실험을 진행.

LightGBM이 전반적으로 가장 균형있는 성능을 보였으며,XGBoost는 살짝 낮지만 준수한 성능을 보임. CatBoost도 정밀도는 낮지만 재현율에서 강점을 보임.

이후 LightGBM, XGBoost, CatBoost에 대해 Optuna를 활용한 하이퍼파라미터 튜닝을 수행.
총 50번의 trial을 돌렸고, 각각의 trial에서는 5-fold Stratified K-Fold 교차검증을 사용해 F1 score 기준으로 최적화를 진행.
튜닝 이후 LGBM에서 F1 스코어 0.8614로 가장 우수한 성능을 보여 최종 모델로 선택.

--------------------------------------------------------------------

SHAP 분석(Feature Elimination)

모델 학습 후, SHAP 값을 활용해 각 피처의 평균 중요도를 계산하고, 중요도가 가장 낮은 피처부터 하나씩 제거하는 방식의 RFE(Recursive Feature Elimination)를 수행

실험 결과, '해당층_결측여부', '전용면적_결측여부', '총주차대수_결측여부' 세 피처는 제거하였을 때 오히려 모델의 F1 스코어가 상승하거나 유지되는 경향을 보임.
이에 따라 해당 결측여부 파생 피처들이 모델 성능에 기여하지 않거나 오히려 잡음을 유발할 수 있다고 판단하여 최종적으로 제거.

--------------------------------------------------------------------

Threshold 튜닝

불균형 데이터에서는 기본 임계값인 0.5가 항상 최적의 기준이 되지 않기 때문에, 임계값(threshold)을 0.1부터 0.9까지 0.05 간격으로 조정하면서 정밀도, 재현율, F1 스코어를 비교 분석.

실험 결과, threshold가 증가할수록 정밀도는 상승하고 재현율은 감소하는 전형적인 trade-off가 관찰되었으며, 두 지표 간의 격차는 threshold=0.2에서 가장 작고, 0.9에 가까울수록 격차가 크게 벌어지는 경향을 보임.

F1 스코어 기준으로는 threshold=0.35일 때 가장 높은 값을 기록했고, 정밀도와 재현율 간 균형도 적절히 유지되었기 때문에 최종 모델에서는 threshold=0.35를 사용
한편, 모델의 안정성을 최우선으로 고려할 경우에는 정밀도-재현율 간 균형이 가장 잘 맞는 threshold=0.2도 대안으로 고려할 수 있음.

--------------------------------------------------------------------


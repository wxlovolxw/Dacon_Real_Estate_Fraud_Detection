--------------------------------------------------------------------

결측치 처리

결측치가 존재하는 주요 피처는 '전용면적', '해당층', '총층', '방수', '욕실수', '총주차대수'였다.
'총층', '방수', '욕실수' 피처는 결측 비율이 매우 낮았고, 결측이 동일한 행에서 함께 발생하는 경향을 보여 데이터 손실을 최소화하기 위해 최빈값으로 대체하였다.

'해당층'은 전체 데이터의 약 9.34%가 결측이었고, 다른 변수들과 독립적이지 않은 조건부 결측 가능성이 존재하여 RandomForest 기반으로 보간하였다.
'총주차대수'는 28.38%라는 높은 결측 비율을 보였고, 보간 전후 분포 차이가 커서 보간 전(raw)과 후(filled) 버전을 모두 유지하였다. 분포 비교는 박스플롯 및 바이올린 플롯을 통해 시각적으로 확인하고, Mann-Whitney U Test를 통해 정량적으로 검증하였다.

'전용면적'은 주로 범주형 변수들과 연관되어 있었고, 랜덤 포레스트보다는 그룹별 중앙값 보간이 적합하다고 판단하여 그룹화 기반 중앙값으로 처리하였다.

'전용면적', '해당층', '총주차대수'는 결측 여부 자체가 타겟 변수(허위매물여부)와 일정한 연관을 보여 결측 여부 파생 피처도 추가 생성하였다.

--------------------------------------------------------------------

이상치 처리 및 변환

연속형 변수들의 군집 여부를 산점도, PCA, KMeans, 실루엣 계수로 분석한 결과 뚜렷한 군집 형태가 없음을 확인하였다.
이에 따라 분포 기반 이상치 탐지가 더 적절하다고 판단하고, 정규성 가정을 하지 않는 IQR 방식을 통해 이상치를 제거하였다.

이상치 제거 후에는 왜도(skewness)를 최소화하는 방향으로 변환을 적용하였다.

'관리비', '보증금'은 로그 변환.
'총층', '해당층', '총주차대수'는 Box-Cox 변환.

변환 전후의 왜도를 비교했을 때, 대부분의 피처에서 정규성에 가까워지는 경향을 확인할 수 있었다.

--------------------------------------------------------------------

특성공학 및 재범주화

    시간 피처 ('게재일')

단순한 년/월/일 분리('year', 'month', 'day', '년월') 외에도, 실제 부동산 정책 변경 시점을 반영하여 '게재일_정책구간'을 생성.
타겟 기반 구간('게재일_구간')도 실험했지만, 과적합 우려로 최종 사용하지 않음.
최종적으로 정보손실이 적은 '년월'과 정책 기반 외생성을 가진 '게재일_정책구간'을 조합하여 사용.

    중개사무소 피처 ('중개사무소')

특정 중개사무소가 과도하게 많은 매물을 차지하는 현상을 관찰하고, Top1, Top5 그룹핑과 빈도 기반 분류('매우많음/중간/희귀')를 적용.
지나친 단순화를 방지하기 위해 Top5와 빈도 기반 그룹핑을 조합하여 활용.

    방향 피처 ('방향')

8방위에 따른 선호도 그룹('남향' 위주)을 구분하여 '방향선호도' 생성.
방향을 0~360도 각도로 변환 후 사인/코사인 인코딩('방향_sin', '방향_cos')을 추가 생성하여, 방향성을 보다 자연스럽게 반영.

--------------------------------------------------------------------

조합 탐색

방향, 중개사무소, 시간 관련 파생 피처를 조합하여 모델을 학습한 결과,

'방향선호도' (vs 사인/코사인 변환)
'중개사무소_빈도기반' (vs Top1 구분)
'년월' (vs 정책구간)

조합이 가장 안정적이고 높은 성능을 보였다.
따라서 해당 조합을 최종 feature set으로 선정하여 후속 실험을 진행하였다.

--------------------------------------------------------------------

데이터 불균형 처리

타겟 '허위매물여부'는 정상 매물이 압도적으로 많아 데이터 불균형 문제가 심각했다.
Borderline-SMOTE, SMOTETomek, Isolation Forest 세 가지 방법을 비교 실험한 결과,
Repeated Hold-out Validation (5회 평균) 기준에서 Isolation Forest가 가장 우수한 일반화 성능을 보였다.

Isolation Forest 적용시 F1 평균 0.8299, Precision-Recall 균형 우수.

이에 따라 최종 데이터 불균형 처리 방법은 Isolation Forest로 결정하였다.

--------------------------------------------------------------------

모델링 및 모델 선택

트리 기반 모델이 결측치와 다중공선성에 강하다는 점을 고려하여 LightGBM, XGBoost, CatBoost, ExtraTrees, Logistic Regression을 실험하였다.

LightGBM과 XGBoost가 가장 우수한 성능을 보였고, CatBoost는 정밀도는 높지만 재현율에서 약간 부족했다.

최종적으로 LightGBM과 XGBoost를 대상으로 Optuna를 이용한 하이퍼파라미터 튜닝을 진행하였다.

튜닝 결과, LightGBM이 가장 높은 F1 스코어를 기록하여 최종 모델로 선정되었다.

--------------------------------------------------------------------

하이퍼파라미터 튜닝 (Optuna)

Optuna를 사용하여 F1 Score를 최대화하는 방향으로 튜닝을 진행하였다.
튜닝 결과, LightGBM은 Best F1 Score 0.9286을 기록하였다.
튜닝 전 대비 성능 향상이 명확했으며, 튜닝된 하이퍼파라미터를 최종 적용하였다.

--------------------------------------------------------------------

SHAP 분석 (Feature Importance)

최종 모델에 대해 SHAP 분석을 수행하여 피처 중요도를 평가하였다.

Top5 피처('년월', '중개사무소_빈도기반', '관리비_log', '총주차대수_filled_boxcox', '월세(만)')의 영향력이 전체 중요도의 83% 이상을 차지함을 확인.

SHAP 영향도가 2% 미만인 피처 제거를 시도했으나 성능 하락이 발생하여, 최종적으로 모든 주요 피처를 유지하였다.

--------------------------------------------------------------------

Threshold 튜닝

불균형 데이터 특성상 기본 Threshold 0.5는 최적이 아닐 수 있다고 판단,
Threshold를 0.1~0.9까지 변경해가며 F1, Precision, Recall을 평가하였다.

Threshold=0.45에서 F1 Score가 가장 높고, Precision-Recall 균형도 적절히 확보됨을 확인.

최종적으로 Threshold=0.45로 설정하여 최종 분류 기준으로 삼았다.

--------------------------------------------------------------------

모델: LightGBM (튜닝 완료) + Isolation Forest 이상치 제거 적용

사용 피처:

관리비_log, 보증금(억)_log, 월세(만)

총층_boxcox, 해당층_boxcox

주차가능여부, 방향선호도

중개사무소_빈도기반, 년월

총주차대수_filled_boxcox, 전용면적_raw

Threshold: 0.45

Validation: Repeated Hold-out Validation (5회 평균)
